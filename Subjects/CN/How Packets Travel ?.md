# How Packet Travels ?

<br>

## The OSI Model
OSI Model (Open Systems Interconnection Model) is a conceptual framework used to describe the functions of a networking system. It is a set of 7 layers which combine to accomplish the end-goal of Computer to Computer communication.

<br>

![img](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-osi-layers.png)

<br>

## @ Layer 1 : Physical layer
1. The Physical layer of the OSI model is responsible for the transfer of bits. 
2. The actual format of the data on the “wire” can vary with each medium. In the case of Ethernet, bits are transferred in the form of electric pulses. In the case of Wifi, bits are transferred in the form of radio waves. In the case of Fiber, bits are transferred in the form of pulses of light.
3. Aside from the physical cable, Repeaters and Hubs also operate at this layer. 
4. **Repeater** simply repeats a signal and increase the range a signal can travel beyond the single cable limit. 
5. **Hub** is a multi-port Repeater. If four devices are connected to Hub, anything sent by one device gets repeated to the other three.


**Simply put, Layer 1 is anything that carries 1’s and 0’s between two nodes.**

<br>


## @ Layer 2 : Data Link layer
1. Data Link layer is responsible for interfacing with the Physical layer. 
2. The **Network Interface Card (NIC)** that you plug your Ethernet wire into handles the Layer 2 functionality. It receives signals from the wire, and transmits signals on to the wire.
3. Layer 2 will then group together those 1’s and 0’s into chunks known as Frames.
4. The **MAC address** uniquely identifies each individual NIC. Each NIC is pre-configured with a MAC address by the manufacturer.


**The role of Layer 2 is to deliver packets from hop to hop.**

<br>


## @ Layer 3 : Network layer
1. It uses **IP address** to logically identify every node connected to the Internet. It is considered logical because an IP address is not a permanent identification of a computer.
2. **Routers** operate at Layer 3 of the OSI model. A Router’s primary responsibility is to facilitate communication between Networks.
3. Router creates a boundary between two networks. In order to communicate with any device not directly in your network, a router must be used.


**Network layer of the OSI model is responsible for packet delivery from end to end.**

<br>

### Q. If we already have MAC addresses, then why do we need IP addresses ?
Both addressing schemes accomplish different functions:

**MAC Address** 
1. It is a globally unique ID for our device.
2. Usefull and efficient for local communications.
3. As more computers joined internet, communication became impossible using MAC address. Hence IP came into picture!


**IP Address**
1. It can group and organize computers in different networks.
2. It is flexible and changeable - making a device mobile.

```
Hence, 

MAC address tells us "Who You Are"  --> (Which will never change)
IP address tells us "Where You Are" --> (Which can change)

They both work together to make sure that message gets delivered to the right person on right network.
```


![gif](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-l2-vs-l3.gif)


1. Layer 2 uses MAC addresses and is responsible for packet delivery from hop to hop.
2. Layer 3 uses IP addresses and is responsible for packet delivery from end to end.


Between each Router, the MAC address header is stripped and regenerated to get it to the next hop. The IP header generated by the first computer is only stripped off by the final computer, hence the IP header handled the “end to end” delivery, and each of the four different MAC headers involved in this animation handled the “hop to hop” delivery.

<br>


## @ Layer 4 : Transport layer
1. It is responsible for distinguishing network streams.
2. Two methods of distinguishing network streams exist. They are known as the **Transmission Control Protocol (TCP)**, or the **User Datagram Protocol (UDP)**.
3. A unique application stream is identified by both Source and Destination port (in combination with their Source and Destination IP address).


**Layer 4 is responsible for service to service delivery.**

<br>

### Q. What is the Need of Transport Layer ?
At any given time on a user’s computer there might be an Internet browser open, while music is being streamed, while a messenger or chat app is running. Each of these applications are sending and receiving data from the Internet, and all that data is arriving in the form of 1’s and 0’s on to that computer’s NIC.

Something has to exist in order to distinguish which 1’s and 0’s belong to the messenger or the browser or the streaming music. That “something” is Layer 4. Layer 4 accomplishes this by using an addressing scheme known as **Port Numbers**. Both TCP and UDP have 65,536 port numbers!

![img](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-layer-4-1024x555.png)

<br>


### Q. How all layers works together ?
As the data is handed from layer to layer, each layer adds the information it requires to accomplish its goal before the complete datagram is converted to 1s and 0s and sent across the wire. For example:
1. Layer 4 will add a TCP header which would include a Source and Destination port.
2. Layer 3 will add an IP header which would include a Source and Destination IP address.
3. Layer 2 would add an Ethernet header which would include a Source and Destination MAC address.

On the receiving end, each layer strips the header from the data and passes it back up the stack towards the Application layers. 

![gif](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-encap-decap.gif)



<br>

## IMP Terminologies

### Switch

![img](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-switch-l2.png)

1. Switch is a network device which operates at Data link layer. The Layer 2 header contains information that enables hop to hop delivery, such as the Source and Destination MAC address.
2. A switch maintains a MAC Address table, that maps MAC addresses of devices plugged into each switch port.
3. MAC Address Table is populated by looking at the Source MAC address field of any received frames.
4. In order to forward the frame, the Switch will lookup the Destination MAC address in their MAC Address Table to determine what port to use.
5. If a Switch encounters a frame for which it does not know the location of the Destination MAC address, it simply duplicates and floods the frame out each switch port (except the port it was received on).

<br>

### Router

![img](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-router-l3.png)

1. Routers operate at Network layer. The Layer 3 header contains information that enables end to end delivery, such as the Source and Destination IP Address.
2. Each interface on a router creates a network boundary.
3. A Router maintains  a Routing Table, which contains paths to all the networks a Router knows how to reach.
4. **When a router receives a packet destined to a network which is not in its Routing Table, that packet is discarded.**

<br>

### ARP (Address Resolution Protocol)
Typically, when two hosts are communicating, they already know each other’s IP address. They can know each other’s IP address from a variety of methods: sometimes it is manually provided by a user, sometimes by another protocol (often DNS). 

However, what is definitely not known is their MAC addresses. The hosts will use ARP to discover the appropriate MAC address. The discovered mapping is then added and stored in an ARP Table, which is a mapping of IP addresses to correlating MAC addresses.

<br>

**How ARP works ?**
1. The ARP Request is sent as a Broadcast, and had there been other hosts connected to this link, they too would have received the ARP Request.
2. Host A includes its own MAC address in the ARP Request itself. This allows Host B (if it exists) to easily respond directly back to Host A with the requested information.
3. Receiving the ARP Request allows Host B to learn something. Namely, that Host A’s IP address is 10.10.10.10 and the correlating MAC address is aaaa.aaaa.aaaa. This entry is now added to Host B’s ARP Table.

<br>


![img](https://www.practicalnetworking.net/wp-content/uploads/2016/01/packtrav-arp-l2-l3.png)

In the image above, there are three networks: the purple network, the gray network, and the red network.
1. When the Client needs to speak to the Purple Server, it will know the Purple Server’s IP address, and from that it will determine that the Purple Server exists in the local network. When a Client is attempting to speak to a host in the same network, the Client will issue an ARP request for the host’s MAC address.
2. When the Client needs to speak to the Red Server, it will know the Red Server’s IP address, and from that it will know that the Red Server exists in a foreign network. As such, the packet must be delivered to the nearest router(R1) also known as Default Gateway.

<br>

Note: Any device that intends to forward a packet based upon the IP address (L3), must also have the ability to deliver the packet to the next hop (L2). Consequently, all Layer 3 devices must maintain an ARP Table.

<br>

**Why ARP is Needed ?**

Packet delivery is always the job of Layer 2 (data link layer), and its primary goal is getting a packet from hop to hop. Conversely, Layer 3 (Network layer), which is concerned with end to end delivery is unable to put a packet on a wire and send it to another host’s NIC. ARP’s role is to help the client create the proper L2 header, based on the L3 header, in order to get the packet from one hop to the next.














